# 多模型情节架构生成功能使用说明

## 功能概述

新的多模型情节架构生成功能能够同时使用多个不同的AI模型生成小说情节架构，让您可以比较不同模型的创作风格，选择最符合期望的版本。

## 支持的模型

目前支持以下4个模型：

1. **Gemini Flash** - 快速响应，适合生成流畅的情节结构
2. **Gemini Pro** - 深度思考，适合生成复杂精细的情节架构  
3. **Qwen Plus** - 中文优化，适合生成符合中文表达习惯的情节
4. **Doubao** - 创意丰富，适合生成新颖独特的情节构思

## 使用方法

### 方法一：使用测试脚本（推荐新手）

1. 运行测试脚本：
```bash
python test_multi_model_plot.py
```

2. 脚本会自动：
   - 生成角色信息和世界观
   - 使用4个模型同时生成情节架构
   - 创建对比文件供您选择

3. 查看生成的文件：
   - `plot_comparison.txt` - 各模型结果对比
   - `plot_gemini-flash.txt` - Gemini Flash版本
   - `plot_gemini-pro.txt` - Gemini Pro版本
   - `plot_qwen-plus.txt` - Qwen Plus版本
   - `plot_doubao.txt` - Doubao版本

### 方法二：在主流程中使用

1. 修改您的 `gen_novel.py` 配置，确保调用 `Novel_architecture_generate` 函数

2. 运行主生成流程，系统会自动使用多模型生成功能

3. 当到达情节架构生成阶段时，会暂停并提示您选择

### 方法三：使用选择工具

运行选择工具来交互式选择最优方案：

```bash
python plot_selector.py [输出目录路径]
```

例如：
```bash
python plot_selector.py ./Novel_Output
```

## 选择流程

### 1. 查看对比文件

打开 `plot_comparison.txt` 文件，您会看到类似以下格式的内容：

```
============================================================
多模型情节架构生成结果对比
============================================================

方案 1: Gemini Flash
----------------------------------------
[情节架构内容...]

方案 2: Gemini Pro  
----------------------------------------
[情节架构内容...]

方案 3: Qwen Plus
----------------------------------------
[情节架构内容...]

方案 4: Doubao
----------------------------------------
[情节架构内容...]
```

### 2. 评估各方案

建议从以下维度评估各个方案：

- **情节连贯性** - 故事情节是否逻辑清晰、环环相扣
- **人物发展** - 角色成长弧线是否合理、有深度
- **冲突设置** - 矛盾冲突是否引人入胜、层次丰富
- **节奏把控** - 故事节奏是否张弛有度、高潮迭起
- **创新性** - 情节设计是否新颖、避免俗套
- **适配度** - 是否符合您的主题和风格要求

### 3. 选择并应用

有两种方式应用您的选择：

#### 手动方式：
1. 选择最优方案
2. 复制该方案的内容
3. 创建或覆盖 `plot.txt` 文件
4. 粘贴内容并保存

#### 工具方式：
1. 运行 `python plot_selector.py`
2. 按提示选择方案序号
3. 工具会自动保存到 `plot.txt`

## 生成的文件说明

| 文件名 | 说明 |
|--------|------|
| `plot_comparison.txt` | 所有模型结果的对比文档 |
| `plot_[模型名].txt` | 各个模型的独立结果文件 |
| `plot_default.txt` | 默认方案（通常是第一个成功生成的结果） |
| `plot.txt` | 最终选择的情节架构（继续生成流程需要此文件） |
| `plot_selection_log.txt` | 选择记录日志 |

## 故障排除

### 问题1：某些模型未生成结果

**可能原因：**
- API密钥失效或额度不足
- 网络连接问题
- 模型服务临时不可用

**解决方案：**
1. 检查日志文件 `multi_model_plot_test.log`
2. 确认API密钥有效且有余额
3. 检查网络连接
4. 如果只有部分模型成功，可以继续使用已生成的结果

### 问题2：对比文件未生成

**可能原因：**
- 所有模型都生成失败
- 文件写入权限问题

**解决方案：**
1. 查看错误日志
2. 检查输出目录权限
3. 手动检查各个 `plot_[模型名].txt` 文件

### 问题3：继续生成时提示找不到plot.txt

**解决方案：**
1. 确认已选择并保存了最终方案到 `plot.txt`
2. 使用选择工具重新选择
3. 手动复制最优方案内容到 `plot.txt`

## 最佳实践

1. **首次使用**：建议先使用测试脚本熟悉功能
2. **批量生成**：如果要生成多个小说，可以为每个项目单独创建目录
3. **备份管理**：重要的情节架构建议保留备份
4. **迭代优化**：可以基于选择的方案进一步手动调整优化
5. **记录选择理由**：在 `plot_selection_log.txt` 中记录选择原因，便于后续参考

## 技术参数调整

如需调整生成参数，可以修改 `architecture.py` 中的模型配置：

```python
model_configs = [
    {
        "name": "gemini-flash",
        "display_name": "Gemini Flash",
        "interface_format": "gemini",
        "base_url": "...",
        "model_name": "...",
        "api_key": "..."
    },
    # 添加更多模型配置
]
```

您也可以调整温度参数来控制创意程度：
- `temperature_plot` - 控制情节生成的创造性（建议值：1.0-1.5）

## 更新日志

- **v1.0** - 初始版本，支持4个主流模型并行生成
- 支持交互式选择工具
- 包含完整的对比和备份功能

---

如有问题，请查看日志文件或联系技术支持。