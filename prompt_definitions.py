# prompt_definitions.py
# -*- coding: utf-8 -*-
"""
集中存放所有提示词 (Prompt)，整合雪花写作法、角色弧光理论、悬念三要素模型等
并包含新增加的前三章摘要/下一章关键字提炼提示词，以及章节正文写作提示词。
"""

# =============== 生成草稿提示词当前章节摘要、知识库提炼 ===============
# 根据前三章节完整内容，以及当前章节和下一章节目录，生成当前章节简短摘要
summarize_recent_chapters_prompt = """\
作为一名专业的小说家，正在基于已完成的前一章内容，前十章章节信息，当前章节信息和下一章信息，生成当前章节的摘要。请严格遵循以下工作流程：
前一章内容：
{combined_text}

前十章章节信息：
{recent_dir}

当前章节信息：
第{novel_number}章《{chapter_title}》：
├── 本章定位：{chapter_role}
├── 核心作用：{chapter_purpose}
├── 悬念密度：{suspense_level}
└── 本章简述：{chapter_summary}

下一章信息：
第{next_chapter_number}章《{next_chapter_title}》：
├── 本章定位：{next_chapter_role}
├── 核心作用：{next_chapter_purpose}
├── 悬念密度：{next_chapter_suspense_level}
└── 本章简述：{next_chapter_summary}

当前章节摘要生成规则：
1. 内容架构：
   - 重点参考当前章节的信息
   - 如果当前章节信息与前一章内容或下一章信息有一定联系，则适当参考前一章内容和下一章信息
   - 不要与前一章内容有明显的重合或相似的剧情

2. 可选结构：根据当前章节信息，选择合适的结构
   - "承继→发展→铺垫"的三段式结构
   - "开场→冲突→高潮→收束"的四段式结构
   - "引入→推进→转折→结尾"的四段式结构

3.(可选)：在合适的章节中加入情感互动剧情，例如：
  * 初次亲吻：紧张而甜蜜的初吻，体现角色内心的忐忑与悸动
  * 深情拥抱：在危机过后或重逢时的紧紧相拥，传达彼此的珍惜
  * 轻抚发丝：温柔地抚摸对方的头发，展现关怀与爱意
  * 十指相扣：漫步时的牵手，或紧张时的握手支持
  * 额头相贴：亲密而纯真的接触，表达深层的情感连接
  * 脸颊轻吻：温柔的问候或告别，体现温暖的情意
  * 肩膀依靠：疲惫或脆弱时的相互依偎，展现信任与陪伴
  * 手背轻吻：绅士风度的体现，或表达敬意与爱慕
  * 眼神交流：深情的凝视，无声胜有声的情感传递
  * 背部轻抚：安慰时的温柔抚摸，给予心理支持

现在请你基于目前故事的进展，用最多400字，写一个简洁明了的「当前章节摘要」；

请按如下格式输出（不需要额外解释）：
当前章节摘要: <这里写当前章节摘要>
"""


# =============== 2. 角色动力学设定（角色弧光模型）===================
character_dynamics_prompt = """你是一名专业的作家，正在为小说设计角色。

 - 小说核心剧情：{topic}

作为专业作家，请为上述故事设计3-6个具有深度与动态成长潜力的核心角色。每个角色应是故事冲突的有机组成部分，并能推动叙事发展。
每个角色需包含以下要素，并请确保各要素之间逻辑自洽且能相互作用：

一、角色基础信息与特点：
背景与外貌： 详细描述其成长环境、社会阶层、职业，以及独特的身体特征、服饰风格等。这些应暗示其性格、经历或所处的世界观。
性别与年龄： 精确设定。
暗藏的秘密或潜在弱点： 一个深刻影响其行为和决策的隐秘信息或本质缺陷。这可以是道德上的困境、技能上的短板、情感上的创伤，或与世界观/其他角色紧密关联的弱点。此弱点应是角色弧线中需要克服的关键障碍。

二、核心驱动力三角（请确保三者之间存在张力或优先级考量）：
表面追求（物质目标）： 角色在故事初期显性地追求的具体、可量化的目标（例如：财富、权力、某个稀有物品、特定职位）。
深层渴望（情感需求）： 隐藏在表面追求之下的、更深层次的情感或心理需求（例如：被认可、归属感、安全感、复仇、爱、自由）。
灵魂需求（哲学层面）： 关乎其价值观、信仰或生存意义的根本性命题（例如：正义、真理、牺牲、救赎、存在的意义）。

三、角色弧线概述（请简要概括关键转变点）：
初始状态： 故事开始时角色的核心特质、信仰与行为模式。
触发事件： 直接导致角色产生内部或外部冲突的关键事件。
认知失调： 触发事件后，角色固有认知受到冲击，内心产生矛盾与挣扎的阶段。
蜕变节点： 角色做出关键选择，其性格、信仰或能力发生质变的核心时刻。
最终状态： 故事结束时角色的最终面貌，与初始状态形成对比。

四、关系冲突网（请设计动态关系，而非静态设定）：
核心关系或对立点： 详细阐述其与**主角（或故事核心人物）**之间的关键联系或主要矛盾。
价值观冲突： 与至少两位其他核心角色之间存在的深层价值观分歧，这些分歧应能引发直接冲突或决策上的对立。
一个合作纽带： 角色与某位其他人物之间基于共同目标或情感建立的合作关系，即便其间可能存在摩擦。
一个隐藏的背叛可能性： 暗示角色在未来有背叛其盟友或现有立场的潜在动机或伏笔。

写作要求：
1.必须设计3-6个核心角色。
2.每个角色信息独立清晰，但整体应构成一个互相关联、能推动故事发展的角色群像。
3.请严格按照上述标题和子标题格式组织内容。
4.字数不限，但请保持信息密度，避免空泛。
5.请仅返回角色设计文本内容，不要包含任何解释或多余的说明。

示例格式：
（以下为示例，请替换为实际内容）
角色一：[角色名称]
一、角色基础信息与特点：
背景与外貌： ...
性别与年龄： ...
暗藏的秘密或潜在弱点： ...

二、核心驱动力三角：
表面追求： ...
深层渴望： ...
灵魂需求： ...

三、角色弧线概述：
初始状态： ...
触发事件： ...
认知失调： ...
蜕变节点： ...
最终状态： ...

四、关系冲突网：
核心关系或对立点： ...
价值观冲突： ...
一个合作纽带： ...
一个隐藏的背叛可能性： ...

角色二：[角色名称]
...（以此类推）

仅给出最终文本，不要解释任何内容。
"""


# =============== 3. 世界构建矩阵（三维度交织法）===================
world_building_prompt = """\
基于以下元素：
- 内容指导：{user_guidance}

- 核心剧情：{topic}

- 角色体系：{character_dynamics_result}

为服务上述内容，请构建小说世界观，包括（社会构成，潜在冲突等维度）

要求：
仅给出最终文本，不要解释任何内容。
"""

# =============== 4. 情节架构 ===================
plot_architecture_prompt = """\
基于以下元素：

- 核心剧情：{topic}

- 角色体系：{character_dynamics}

- 世界观：{world_building}

要求按以下结构设计：
第一幕（触发） 
- 日常状态中的异常征兆（铺垫）
- 引出故事：展示主线、暗线、副线的开端
- 关键事件：打破平衡的催化剂（需改变角色的关系）
- 错误抉择：主角的认知局限导致的错误反应

第二幕（对抗）
- 剧情升级：主线+副线的交叉点
- 双重压力：外部障碍升级+内部挫折
- 虚假胜利：看似解决实则深化危机的转折点
- 灵魂黑夜：世界观认知颠覆时刻

第三幕（解决）
- 代价显现：解决危机必须牺牲的核心价值
- 嵌套转折：至少包含三层认知颠覆（表面解决→新危机→终极抉择）
- 余波：留下开放式悬念因子

每个阶段需包含关键转折点及其对应的伏笔回收方案。
仅给出最终文本，不要解释任何内容。
"""

# =============== 5. 章节目录生成（悬念节奏曲线）===================
chapter_blueprint_prompt = """\
基于以下元素：
- 小说架构：{novel_architecture}

设计{number_of_chapters}章的节奏分布：
1. 章节集群划分：
- 每3-5章构成一个悬念单元，包含完整的小高潮
- 章节节奏不要过快
- 关键转折章需预留多视角铺垫

2. 事件逻辑连贯性：
- 重要事件（如会议、活动、宴会、生日等）必须在之前章节中有所铺垫或提及
- 避免突然出现未曾暗示的重要场景或转折点
- 每个新环境或重要事件的引入都应有合理的引导过程

3. 每章需明确：
- 章节定位（角色/事件/主题等）
- 与前后章节的逻辑衔接点

输出格式示例：
第n章 - [标题]
本章定位：[角色/事件/主题/...]
核心作用：[铺垫/推进/转折/揭示/...]
悬念密度：[平缓/紧凑/渐进/爆发/...]
衔接要素：[承接前章的XXX/为下章XXX做铺垫]
本章简述：[简短概括]

第n+1章 - [标题]
本章定位：[角色/事件/主题/...]
核心作用：[铺垫/推进/转折/揭示/...]
悬念密度：[平缓/紧凑/渐进/爆发/...]
衔接要素：[承接前章的XXX/为下章XXX做铺垫]
本章简述：[简短概括]

要求：
- 使用精炼语言描述，每章字数控制在150字以内。
- 合理安排节奏，确保整体悬念曲线的连贯性。
- 章节之间连贯过渡，避免突兀。
- 章节之间的内容不要有大量重复或相似内容。
- 在生成{number_of_chapters}章前不要出现结局章节。

仅给出最终文本，不要解释任何内容。
"""

chunked_chapter_blueprint_prompt = """\
你是一名专业的小说家，请你基于以下元素，生成总共{number_of_chapters}章的小说章节信息：

- 小说架构：{novel_architecture}

当前已有章节信息（若为空则说明是初始生成）：\n
{chapter_list}

现在请设计第{n}章到第{m}的章节信息：
1. 章节集群划分：
- 每3-5章构成一个悬念单元，包含完整的小高潮
- 章节节奏不要过快
- 关键转折章需预留多视角铺垫

2. 事件逻辑连贯性：
- 重要事件（如会议、活动、宴会、生日等）必须在之前章节中有所铺垫或提及
- 避免突然出现未曾暗示的重要场景或转折点
- 每个新环境或重要事件的引入都应有合理的引导过程

3. 每章需明确：
- 章节定位（角色/事件/主题等）
- 与前后章节的逻辑衔接点

输出格式示例：
第n章 - [标题]
本章定位：[角色/事件/主题/...]
核心作用：[推进/转折/揭示/...]
悬念密度：[紧凑/渐进/爆发/...]
衔接要素：[承接前章的XXX/为下章XXX做铺垫]
本章简述：[简短而精确地概括]

第n+1章 - [标题]
本章定位：[角色/事件/主题/...]
核心作用：[推进/转折/揭示/...]
悬念密度：[紧凑/渐进/爆发/...]
衔接要素：[承接前章的XXX/为下章XXX做铺垫]
本章简述：[简短而精确地概括]

要求：
- 使用精炼语言描述，每章字数控制在150字以内。
- 合理安排剧情发展节奏，剧情可以包括主线、副线、日常等。
- 小说架构中的剧情架构只是主要剧情，你可以发挥你的想象力，加入更多合理的剧情元素。
- 章节之间连贯过渡，避免突兀。
- 章节之间的内容不要有明显的重复或相似内容。
- 在生成{number_of_chapters}章前不要出现结局章节。

仅给出最终文本，不要解释任何内容。
"""

# =============== 6. 前文摘要更新 ===================
"""
摘要生成逻辑：“生成第N章正文 → 用第N章正文更新摘要(global_summary) → 
生成第N+1章正文时引用已更新的摘要 → 再用第N+1章正文继续更新摘要(global_summary)
"""
summary_prompt = """你是一位专业的叙事概括专家，你的任务是根据新提供的章节内容，更新现有的故事摘要。

以下是新完成的章节内容：
{chapter_text}

这是当前的故事摘要（可为空）：
{global_summary}

请根据新完成的章节内容，更新故事摘要。
要求：
- 保留既有重要信息，同时融入新剧情要点
- 以简洁、连贯的语言描述全书进展
- 客观描绘，不展开联想或解释
- 总字数控制在500字以内

仅返回前文摘要文本，不要解释任何内容。
"""

# =============== 7. 角色状态更新 ===================
create_character_state_prompt = """\
依据当前角色动力学设定：
{character_dynamics}

生成一个小说角色状态文档：
示例格式（请替换为实际内容）:
角色一：张三
[性格]
-开朗、有活力，喜欢与他人互动
[背景与外貌]
-来自农村的普通男孩，外表普通
[主要角色间关系网]
-李四：张三从小就与她有关联，对她的成长一直保持关注
-王二：两人之间有着复杂的过去，最近因一场冲突而让对方感到威胁
[触发或加深的事件]
-村庄内突然出现不明符号，似乎在暗示柳溪镇即将发生重大事件
-李四被刺穿皮肤，让两人意识到对方的强大实力，促使他们迅速离开队伍

角色二：[角色名称]
...（以此类推）

新出场角色：
- (此处填写未来任何新增角色或临时出场人物的基本信息)

要求：
1.仅返回编写好的角色状态文本，不要解释任何内容。
2.格式参照示例格式，注意使用"[]"和"- "标识符。
3.不要使用markdown格式
"""

update_character_state_prompt = """\
请根据新完成的章节文本，更新角色状态文档和新出场角色：

以下是新完成的章节文本：
{chapter_text}

当前的角色状态文档：
{old_state}

新出场角色：
- 任何新增角色或临时出场人物的基本信息，简要描述即可，不要展开，淡出视线的角色可删除。

要求：
- 请直接在已有文档基础上进行增加或删减
- 不改变原有结构，语言简洁
- 无需对角色的[性格]、[背景与外貌]和[主要角色关系网]进行更新
- 仅对角色的[触发或加深的事件]进行更新，只记录关键的事件
- 如果没有新出场角色，则不用更新新出场角色
- 不要使用markdown格式

仅返回更新后的角色状态文档和新出场角色，不要做任何解释。
"""

# =============== 8. 章节正文写作 ===================

# 8.1 第一章草稿提示
first_chapter_draft_prompt = """\
你是一位擅长创作{genre}小说的资深作家。
即将创作：
第 {novel_number} 章《{chapter_title}》：
- 本章定位：{chapter_role}
- 核心作用：{chapter_purpose}
- 悬念密度：{suspense_level}
- 衔接要素：{connection_elements}
- 本章简述：{chapter_summary}

参考文档：
- 小说设定：
{novel_setting}

下一章节目录
第{next_chapter_number}章《{next_chapter_title}》：
- 章节定位：{next_chapter_role}
- 核心作用：{next_chapter_purpose}
- 悬念密度：{next_chapter_suspense_level}
- 衔接要素：{next_connection_elements}
- 章节简述：{next_chapter_summary}

完成第 {novel_number} 章的正文，字数要求{word_number}字。

格式要求：
- 仅返回章节正文文本；
- 不使用分章节小标题；
- 不要使用markdown格式。

额外指导：正文内容必须足够有吸引力和冲击力，开头3句话必须立即抓住读者注意力。
"""

# 8.2 后续章节草稿提示
'''
next_chapter_draft_prompt = """\
你是一位擅长创作{genre}小说的资深作家，请根据以下提供的前文摘要、前一章结尾段、用户指导、角色状态、当前章节摘要、当前章节信息和下一章节目录，完成第 {novel_number} 章的正文，字数要求{word_number}字

- 前文摘要：
    {global_summary}

- 前一章结尾段：
    {previous_chapter_excerpt}

- 用户指导：
    {user_guidance}

- 角色状态：
    {character_state}

- 当前章节摘要：
    {short_summary}

当前章节信息：
第{novel_number}章《{chapter_title}》：
├── 章节定位：{chapter_role}
├── 核心作用：{chapter_purpose}
├── 悬念密度：{suspense_level}
├── 章节简述：{chapter_summary}
└── 字数要求：{word_number}字

下一章节目录
第{next_chapter_number}章《{next_chapter_title}》：
├── 章节定位：{next_chapter_role}
├── 核心作用：{next_chapter_purpose}
├── 悬念密度：{next_chapter_suspense_level}
└── 章节简述：{next_chapter_summary}

内容生成严格遵循：
-确保章节内容与前文摘要、前章结尾段、下一章目录衔接流畅
-当前章节内容不能与前文内容有明显重复或相似剧情

格式要求：
- 仅返回章节正文文本，不要做任何说明
- 不使用分章节小标题
- 不要使用markdown格式。
"""
'''

next_chapter_draft_prompt = """\
你是一位擅长创作{genre}小说的资深作家，请根据以下提供的前一章内容、用户指导、角色状态、当前章节摘要、当前章节信息和下一章节目录，完成第 {novel_number} 章的正文，字数至少{word_number}字

- 前一章内容：
{previous_chapter_excerpt}

- 角色状态：
{character_state}

- 当前章节摘要：
{short_summary}

当前章节信息：
第{novel_number}章《{chapter_title}》：
- 章节定位：{chapter_role}
- 核心作用：{chapter_purpose}
- 悬念密度：{suspense_level}
- 衔接要素：{connection_elements}
- 章节简述：{chapter_summary}
- 字数要求：{word_number}字

下一章节目录
第{next_chapter_number}章《{next_chapter_title}》：
- 章节定位：{next_chapter_role}
- 核心作用：{next_chapter_purpose}
- 悬念密度：{next_chapter_suspense_level}
- 衔接要素：{next_connection_elements}
- 章节简述：{next_chapter_summary}

内容生成严格遵循：
-确保章节内容与前文一章内容、下一章目录衔接流畅
-特别注意当前章节的衔接要素，确保在正文中体现相应的衔接内容
-当前章节内容不能与前一章内容有明显重复或相似剧情，不能使用相似的叙事方式

格式要求：
- 仅返回章节正文文本，不要做任何说明
- 不使用分章节小标题
- 不要使用markdown格式。
"""


reverse_plot_prompt = """你是一位资深的言情小说编剧，擅长设计令人震撼的剧情反转。

小说剧情：
{plot}

请在原剧情基础上添加一个核心反转元素，要求：
1. 反转必须在逻辑上合理，与已有剧情线索相呼应
2. 避免突兀的设定，确保反转有足够的铺垫

直接输出完整的修改后剧情，保持原有的叙述风格和结构，不要使用markdown格式。"""